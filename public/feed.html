<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Feed - Primemar</title>
    <link rel="stylesheet" href="/css/base.css">
    <link rel="stylesheet" href="/css/feed.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- Navigation -->
    <nav class="main-nav">
        <div class="container">
            <div class="nav-content">
                <div class="nav-brand">
                    <a href="/feed.html" class="logo">
                        <i class="fas fa-crown"></i>
                        Primemar
                    </a>
                </div>
                
                <div class="nav-search">
                    <i class="fas fa-search"></i>
                    <input type="text" placeholder="Search Primemar" id="searchInput">
                </div>
                
                <div class="nav-links">
                    <a href="/feed.html" class="nav-link active">
                        <i class="fas fa-home"></i>
                        <span>Home</span>
                    </a>
                    <a href="/messages.html" class="nav-link">
                        <i class="fas fa-envelope"></i>
                        <span>Messages</span>
                        <span class="badge" id="messageBadge">0</span>
                    </a>
                    <a href="/subscriptions.html" class="nav-link">
                        <i class="fas fa-star"></i>
                        <span>Subscriptions</span>
                    </a>
                    <a href="/profile.html" class="nav-link">
                        <i class="fas fa-user"></i>
                        <span>Profile</span>
                    </a>
                    <div class="nav-wallet" id="walletInfo">
                        <i class="fas fa-wallet"></i>
                        <span>Loading...</span>
                    </div>
                    <button class="btn btn-primary btn-post">
                        <i class="fas fa-plus"></i>
                        <span>Post</span>
                    </button>
                    <div class="nav-profile">
                        <img id="navAvatar" src="" alt="Profile" class="avatar-sm">
                        <div class="dropdown">
                            <button class="dropdown-toggle">
                                <i class="fas fa-chevron-down"></i>
                            </button>
                            <div class="dropdown-menu">
                                <a href="/profile.html"><i class="fas fa-user"></i> Profile</a>
                                <a href="/settings.html"><i class="fas fa-cog"></i> Settings</a>
                                <a href="#" id="logoutBtn"><i class="fas fa-sign-out-alt"></i> Logout</a>
                            </div>
                        </div>
                    </div>
                </div>
                
                <button class="nav-toggle" id="navToggle">
                    <i class="fas fa-bars"></i>
                </button>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container">
        <div class="feed-layout">
            <!-- Left Sidebar -->
            <aside class="sidebar left-sidebar">
                <div class="sidebar-card">
                    <h3>Trending Now</h3>
                    <div class="trending-list" id="trendingList">
                        <div class="loading">
                            <div class="spinner"></div>
                        </div>
                    </div>
                </div>
                
                <div class="sidebar-card">
                    <h3>Who to Follow</h3>
                    <div class="suggestions-list" id="suggestionsList">
                        <div class="loading">
                            <div class="spinner"></div>
                        </div>
                    </div>
                </div>
            </aside>

            <!-- Main Feed -->
            <main class="feed-main">
                <!-- Create Post -->
                <div class="create-post-card">
                    <div class="create-post-header">
                        <img id="createPostAvatar" src="" alt="Profile" class="avatar-md">
                        <textarea 
                            id="postContent" 
                            placeholder="What's happening?"
                            rows="3"
                            maxlength="280"></textarea>
                    </div>
                    
                    <div class="create-post-actions">
                        <div class="media-options">
                            <button class="btn-icon" id="addImage">
                                <i class="fas fa-image"></i>
                            </button>
                            <button class="btn-icon" id="addVideo">
                                <i class="fas fa-video"></i>
                            </button>
                            <button class="btn-icon" id="addPoll">
                                <i class="fas fa-chart-bar"></i>
                            </button>
                        </div>
                        
                        <div class="post-controls">
                            <span class="char-count" id="charCount">280</span>
                            <button class="btn btn-primary" id="submitPost">
                                Post
                            </button>
                        </div>
                    </div>
                    
                    <input type="file" id="mediaUpload" accept="image/*,video/*" hidden>
                </div>

                <!-- Feed Tabs -->
                <div class="feed-tabs">
                    <button class="tab-btn active" data-feed="for-you">For You</button>
                    <button class="tab-btn" data-feed="following">Following</button>
                    <button class="tab-btn" data-feed="boosted">Boosted</button>
                </div>

                <!-- Posts Container -->
                <div class="posts-container" id="postsContainer">
                    <div class="loading">
                        <div class="spinner"></div>
                    </div>
                </div>
            </main>

            <!-- Right Sidebar -->
            <aside class="sidebar right-sidebar">
                <!-- Wallet Card -->
                <div class="sidebar-card wallet-card">
                    <h3>Your Wallet</h3>
                    <div class="wallet-balance">
                        <div class="balance-item">
                            <span class="balance-label">SA Tokens</span>
                            <span class="balance-value" id="saBalance">0</span>
                        </div>
                        <div class="balance-item">
                            <span class="balance-label">USD Balance</span>
                            <span class="balance-value" id="usdBalance">$0.00</span>
                        </div>
                        <div class="balance-item">
                            <span class="balance-label">Today's Earnings</span>
                            <span class="balance-value" id="dailyEarnings">0 SA</span>
                        </div>
                    </div>
                    <div class="wallet-actions">
                        <button class="btn btn-sm btn-primary" id="withdrawBtn">
                            <i class="fas fa-money-bill-wave"></i> Withdraw
                        </button>
                        <button class="btn btn-sm btn-outline" id="buySaBtn">
                            <i class="fas fa-shopping-cart"></i> Buy SA
                        </button>
                    </div>
                </div>

                <!-- Verification Card -->
                <div class="sidebar-card verification-card" id="verificationCard">
                    <div class="loading">
                        <div class="spinner"></div>
                    </div>
                </div>

                <!-- Boost Card -->
                <div class="sidebar-card boost-card">
                    <h3>Boost Your Post</h3>
                    <p>Increase visibility with SA tokens</p>
                    <div class="boost-options">
                        <div class="boost-option">
                            <h4>Small Boost</h4>
                            <p>50 SA</p>
                            <button class="btn btn-sm btn-outline">Select</button>
                        </div>
                        <div class="boost-option">
                            <h4>Medium Boost</h4>
                            <p>200 SA</p>
                            <button class="btn btn-sm btn-outline">Select</button>
                        </div>
                        <div class="boost-option">
                            <h4>Large Boost</h4>
                            <p>500 SA</p>
                            <button class="btn btn-sm btn-outline">Select</button>
                        </div>
                    </div>
                </div>
            </aside>
        </div>
    </div>

    <!-- Floating Action Button -->
    <button class="fab" id="createPostFab">
        <i class="fas fa-plus"></i>
    </button>

    <!-- Modals -->
    <div class="modal" id="postModal">
        <div class="modal-content">
            <!-- Post content will be loaded here -->
        </div>
    </div>

    <script type="module" src="/js/feed/fetchFeed.js"></script>
    <script type="module" src="/js/feed/createPost.js"></script>
    <script type="module" src="/js/monetization/wallet.js"></script>
    <script type="module" src="/js/auth/logout.js"></script>
    <script type="module">
        import { requireAuth } from './js/guards/authGuard.js'
        import { supabase } from './js/config/supabase.js'
        
        // Check authentication
        requireAuth('/login.html')
        
        // Initialize wallet display
        async function loadWallet() {
            const user = await requireAuth()
            if (!user) return
            
            const { data: wallet, error } = await supabase
                .from('wallets')
                .select('*')
                .eq('user_id', user.id)
                .single()
            
            if (!error && wallet) {
                document.getElementById('saBalance').textContent = wallet.sa_balance
                document.getElementById('usdBalance').textContent = `$${wallet.usd_balance.toFixed(2)}`
            }
        }
        
        loadWallet()
        
        // Navigation toggle for mobile
        document.getElementById('navToggle').addEventListener('click', () => {
            document.querySelector('.nav-links').classList.toggle('active')
        })
    </script>
</body>
</html>